<!DOCTYPE html>
<html lang="en">
<head>
    <title>Display a map</title>
    <meta property="og:description" content="Initialize a map in an HTML element with MapLibre GL JS." />
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js'></script>
    <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        const map = new maplibregl.Map({
            container: 'map', // container id
            style: 'https://tiles.stadiamaps.com/styles/stamen_toner_lite.json', // style URL
            center: [-0.13067, 51.5068], // starting position [lng, lat]
            zoom: 12
             // starting zoom
        });

        var parksInformation = false;
        var parksShapes = false;
        var popup = new maplibregl.Popup({closeOnClick: false})

        mergeParkData = function (parkinfo, parkshapes){
                console.log(parkinfo);
                console.log(parkshapes);
                parkshapes.features.forEach((feature) => {
                   console.log(feature.properties);
                   let data = parkinfo.filter((info)=>info.name == feature.properties.name);
                   console.log(data);
                   feature.properties = data[0]
                });
                console.log
            }

        map.on('load', () =>{

            fetch('./data_files/uk_local_district_boundaries.json')
            .then(response => response.json())
            .then(response => {
                console.log(response);
                
                map.addSource("boroughs_shapes",{
                    type : "geojson",
                    data :  response             
                 })

                map.addLayer({
                    id : "boroughs_line_layer",
                    type : "line",
                    source : "boroughs_shapes",
                    paint : {
                        "line-opacity" : 0.5,
                        "line-color" : "#000000",
                        "line-width" : 2.5
                    }
                })
            })


            fetch('./data_files/london_parks_info.json')
                .then(response => response.json())
                .then(response => {
                parksInformation = response;
                console.log(parksInformation);
            })
            fetch('./data_files/park_shapes_source.json')
                .then(response => response.json())
                .then(response => {
                parksShapes = response;
                console.log(parksShapes);
            
                map.addSource("parkShapesSource",{
                    type : "geojson",
                    data : response
                })
                map.addLayer({
                    id : "park_shapes_layer",
                    type : "fill",
                    source : "parkShapesSource",
                    paint : {
                        'fill-color' : [
                            'match',
                            ['get', 'Status'],
                            'Open', '#50b848',
                            'Defunct', '#ff4c3f',
                            'Under Threat', '#FDFD11',
                            '#5A5AE2'
                        ],
                        'fill-opacity' : 0.5
                        
                    }
                })
            })
            
        })
        map.on('click', 'park_shapes_layer', function(e){
            const clickedFeatures = map.queryRenderedFeatures(e.point, { layers : ['park_shapes_layer']})
            console.log(clickedFeatures)

            let clickedParkName = clickedFeatures[0].properties.name;
            let yearOpened = 0;
            parksInformation.forEach(function(thisPark){
                if(thisPark.name === clickedParkName){
                    yearOpened = thisPark["year opened"];
                    
                } 
            })
            popup.setLngLat(e.lngLat).setHTML(
                `${clickedParkName} was opened in ${yearOpened}`
            ).addTo(map)
            
            mergeParkData (parksInformation, parksShapes);
        })
    </script>
</body>




      